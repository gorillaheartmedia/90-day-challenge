<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Custom 90-Day 5-Goal Tracker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- CSS will be added in the next step -->
  <link rel="stylesheet" href="styles.css">
</head>
<body>
<style>
  body {
  font-family: 'Segoe UI', Arial, sans-serif;
  background: linear-gradient(115deg, #e7f7fd 0%, #d4e6fc 100%);
  min-height: 100vh;
  margin: 0;
  padding: 0;
  overflow-x: hidden;
}
.container {
  max-width: 990px;
  margin: 34px auto 30px auto;
  background: rgba(255,255,255,0.88);
  border-radius: 30px;
  box-shadow: 0 10px 36px 0 rgba(54,86,120,0.10), 0 2px 4px 0 rgba(74,124,170,0.06);
  padding: 34px 15px 26px 15px;
  backdrop-filter: blur(7px);
}
h1 {
  text-align: center;
  font-size: 2.22em;
  font-weight: 800;
  margin-bottom: 4px;
  background: linear-gradient(90deg,#319cfa 10%,#6ffab6 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  text-fill-color: transparent;
  filter: drop-shadow(0 2px 4px #319cfa16);
}
.settings-bar {
  text-align: right;
  margin-bottom: 12px;
  padding-right: 16px;
}
.settings-btn {
  background: linear-gradient(90deg,#d7eaf6 60%,#c6f7e6 100%);
  border: 1.7px solid #6bdad9;
  color: #2995d1;
  border-radius: 12px;
  padding: 7px 18px;
  font-size: 1.08em;
  font-weight: 700;
  cursor: pointer;
  transition: all 0.15s;
  box-shadow: 0 1.5px 7px #57e9e344;
  margin-bottom: 2px;
}
.settings-btn:hover {
  background: #31e5a533;
  color: #17825b;
  border-color: #37b599;
}
.progress-section {
  text-align: center;
  margin-bottom: 18px;
}
.progress-bar-bg {
  width: 73%;
  background: rgba(220,234,250,0.69);
  border-radius: 19px;
  height: 28px;
  margin: 0 auto 12px;
  box-shadow: 0 1.5px 6px 0 rgba(49,180,250,0.11);
  overflow: hidden;
  border: 1.5px solid #b9e3fa7a;
  position: relative;
}
.progress-bar {
  background: linear-gradient(90deg, #41e1a8 2%, #319cfa 96%);
  height: 28px;
  border-radius: 19px;
  width: 0%;
  box-shadow: 0 2px 14px #41e1a850 inset;
  transition: width 0.9s cubic-bezier(0.31,0.67,0.49,1.13);
}
.percentage {
  font-size: 1.19em;
  font-weight: 700;
  color: #145f8d;
  text-shadow: 0 1px 2px #b0e7f6cc;
  display: inline-block;
  margin-bottom: 8px;
}
table {
  border-collapse: separate;
  border-spacing: 0 6px;
  width: 100%;
  background: none;
  margin-bottom: 13px;
  font-size: 1.06em;
  box-shadow: none;
}
th, td {
  border: none;
  padding: 8px 4px;
  text-align: center;
  background: rgba(255,255,255,0.81);
  border-radius: 11px;
  box-shadow: 0 2.5px 10px #bbd2ea18;
  font-weight: 500;
  vertical-align: middle;
  position: relative;
}
th {
  background: linear-gradient(90deg,#e5f7fd 50%,#e8fff5 100%);
  font-size: 1.03em;
  font-weight: 700;
  color: #269fc9;
  letter-spacing: 0.01em;
  box-shadow: 0 1.5px 4px #b5dffc21;
  cursor: pointer;
  position: relative;
  user-select: none;
  transition: color 0.14s;
}
th.goal-name:hover {
  color: #218fc6;
  text-decoration: underline;
}
tr { transition: background 0.17s; }
tr:hover td { background: #f0f9ffb3 !important; }
.goal-btn-group {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 7px;
  min-width: 115px;
}
.goal-btn {
  width: 90px;
  min-width: 100px;
  max-width: 120px;
  height: 36px;
  background: linear-gradient(90deg, #f5fafd 70%, #e4f6f6 100%);
  border: 2.2px solid #b5c2d1;
  color: #3791d1;
  border-radius: 10px;
  font-size: 1.02em;
  font-weight: 500;
  cursor: pointer;
  outline: none;
  transition: background 0.19s, border-color 0.19s, color 0.14s, box-shadow 0.2s, transform 0.16s;
  box-shadow: 0 2px 10px #60d0fb17;
  display: inline-block;
  text-align: center;
  vertical-align: middle;
  white-space: nowrap;
}
.goal-btn:active { background: #dafce8; transform: scale(0.93);}
.goal-btn.completed {
  background: linear-gradient(90deg, #49dfa0 15%, #31b7fa 100%);
  color: #fff;
  border: 2.2px solid #30a987;
  font-weight: 700;
  box-shadow: 0 2px 16px #31b7fa34 inset;
  transform: scale(1.08);
  letter-spacing: 0.01em;
  filter: drop-shadow(0 1.8px 6px #36deac60);
}
.star-slot {
  width: 1.8em; height: 1.8em;
  display: flex;
  align-items: center; justify-content: center;
}
.star {
  color: #ffd700;
  font-size: 1.38em;
  filter: drop-shadow(0 2px 4px #f7d73d6a);
  animation: shine 0.7s;
  margin-left: 0.08em;
  margin-right: 0.08em;
  vertical-align: middle;
  line-height: 1;
}
@keyframes shine {
  0% { transform: scale(0.7) rotate(-18deg);}
  62% { transform: scale(1.25) rotate(10deg);}
  90% { filter: drop-shadow(0 2px 15px #ffe670);}
  100% { transform: scale(1) rotate(0);}
}
.notes-row td {
  background: #f7fbfc;
  border-radius: 13px;
  padding: 7px 6px 13px 6px;
  text-align: left;
  box-shadow: 0 1px 8px #b7e2f930;
  font-size: 1em;
  border-top: none;
}
.note-input {
  width: 99%;
  min-width: 60px;
  min-height: 22px;
  font-size: 1em;
  font-family: inherit;
  border: 1.5px solid #c2e2f6;
  border-radius: 7px;
  padding: 6px 7px;
  box-sizing: border-box;
  resize: vertical;
  background: #fff;
  margin-top: 2px;
  transition: border-color 0.14s;
}
.note-input:focus {
  outline: none;
  border-color: #51d9e6;
  background: #f0fbf9;
}
.note-label {
  color: #48adc4;
  font-size: 0.97em;
  font-weight: 600;
  margin-bottom: 3px;
  display: block;
  letter-spacing: 0.01em;
}
.perfect-day {
  color: #ffd700;
  font-size: 1.48em;
  font-weight: 800;
  display: inline-block;
  margin-left: 6px;
  vertical-align: middle;
  animation: pop 0.7s cubic-bezier(.22,1.01,.69,.95);
  text-shadow: 0 2px 10px #ffef8598;
  filter: drop-shadow(0 1.5px 9px #ffd70095);
}
@keyframes pop {
  0% { transform: scale(0.7);}
  70% { transform: scale(1.35);}
  100% { transform: scale(1);}
}
.small-note {
  color: #708497;
  font-size: 0.98em;
  margin-top: 13px;
  text-align: center;
  opacity: 0.88;
  letter-spacing: 0.01em;
  padding-bottom: 2px;
}
@media (max-width: 730px) {
  .container { padding: 8px 0.5vw; max-width: 100vw;}
  .progress-bar-bg { width: 98%; }
  th, td { font-size: 0.93em; padding: 5px 1px;}
  h1 { font-size: 1.2em;}
  .goal-btn { width: 74px; min-width: 74px; max-width: 74px; font-size: 0.93em;}
}
tr.today-row td {
  border: 2.5px solid #68e7b8 !important;
  background: #f7fffab3 !important;
  font-weight: 700;
  box-shadow: 0 1.5px 11px #68e7b81c;
}
/* Modal styles for wizard/goal info */
.modal-bg {
  display: none;
  position: fixed;
  top:0; left:0; width:100vw; height:100vh;
  background: rgba(60,100,170,0.14);
  z-index: 10000;
  align-items: center;
  justify-content: center;
  transition: background 0.22s;
}
.modal-bg.active { display: flex; }
.modal-card {
  background: #fff;
  border-radius: 22px;
  box-shadow: 0 10px 42px #39b7fa2b, 0 3px 10px #aae9d728;
  padding: 35px 25px 28px 25px;
  max-width: 92vw;
  width: 410px;
  text-align: center;
  position: relative;
  animation: pop .32s cubic-bezier(.22,1.01,.69,.95);
}
.modal-card h2 {
  margin: 0 0 18px 0;
  font-size: 1.22em;
  color: #2ca7e4;
  font-weight: 800;
  letter-spacing: 0.01em;
}
.modal-card p {
  color: #33547a;
  font-size: 1.06em;
  line-height: 1.5em;
  margin: 0 0 8px 0;
}
.close-modal {
  position: absolute;
  right: 22px;
  top: 16px;
  font-size: 1.6em;
  color: #49dfa0;
  cursor: pointer;
  font-weight: 800;
  border: none;
  background: none;
  outline: none;
  transition: color 0.13s;
  z-index: 101;
}
.close-modal:hover { color: #eb5656; }
.wizard-step { margin-bottom: 16px; }
.wizard-progress {
  color: #319cfa; font-size: 0.97em; font-weight: 700;
  margin-bottom: 10px;
  letter-spacing: 0.01em;
}
.wizard-actions {
  margin-top: 16px;
  text-align: center;
}
.wizard-actions button {
  background: linear-gradient(90deg,#5eebae 30%,#36a7ee 100%);
  color: #fff; border: none; border-radius: 9px;
  padding: 7px 23px; font-size: 1.1em; font-weight: 700;
  margin: 0 7px; box-shadow: 0 1.5px 10px #54dfd44e;
  cursor: pointer; transition: background 0.14s;
}
.wizard-actions button:hover {
  background: linear-gradient(90deg,#36a7ee 10%,#5eebae 100%);
}
.wizard-input, .wizard-textarea, .wizard-date {
  width: 99%; border-radius: 7px; padding: 8px 6px;
  font-size: 1.06em; border: 1.6px solid #b8e0e9;
  background: #f9fcfd; margin-bottom: 2px; font-family: inherit;
  transition: border-color 0.12s;
}
.wizard-textarea { min-height: 34px; }
.wizard-input:focus, .wizard-textarea:focus, .wizard-date:focus {
  outline: none; border-color: #39e7d2; background: #f6fcfa;
}
.wizard-summary {
  background: #f5fafc;
  border-radius: 14px;
  padding: 13px 8px;
  margin-bottom: 13px;
  font-size: 1.05em;
  color: #27809c;
  box-shadow: 0 1px 9px #b9f6ed33;
  text-align: left;
}
.wizard-summary b { color: #249da7; }
</style>
  <div class="container">
    <div class="settings-bar">
      <button class="settings-btn" id="open-wizard-btn">New Challenge / Edit Goals</button>
    </div>
    <h1 id="challenge-title">90-Day 5-Goal Daily Tracker</h1>
    <div class="progress-section">
      <div class="progress-bar-bg">
        <div class="progress-bar" id="progress-bar"></div>
      </div>
      <span class="percentage" id="percent"></span>
      <div class="small-note" id="challenge-dates"></div>
    </div>
    <table id="tracker-table">
      <thead>
        <tr>
          <th>Date</th>
          <th class="goal-name" data-goalid="0"></th>
          <th class="goal-name" data-goalid="1"></th>
          <th class="goal-name" data-goalid="2"></th>
          <th class="goal-name" data-goalid="3"></th>
          <th class="goal-name" data-goalid="4"></th>
          <th>Perfect Day?</th>
        </tr>
      </thead>
      <tbody id="tracker-body"></tbody>
    </table>
    <div class="small-note">
      ‚≠ê Click each button to complete a goal.<br>
      Click a <u>goal name</u> for details.<br>
      Progress and notes are saved in your browser.<br>
      <b>Tip:</b> Bookmark this page for quick access every day!
    </div>
  </div>

  <!-- Success and Perfect Sounds -->
  <audio id="success-sound" src="success.mp3" preload="auto"></audio>
  <audio id="perfect-sound" src="perfect.mp3" preload="auto"></audio>

  <!-- Goal Modal -->
  <div class="modal-bg" id="goal-modal-bg">
    <div class="modal-card" id="goal-modal-card">
      <button class="close-modal" id="close-goal-modal">&times;</button>
      <h2 id="goal-modal-title"></h2>
      <p id="goal-modal-desc"></p>
    </div>
  </div>
  
  <!-- Step-by-step Wizard Modal -->
  <div class="modal-bg" id="wizard-modal-bg">
    <div class="modal-card" id="wizard-modal-card">
      <button class="close-modal" id="close-wizard-modal">&times;</button>
      <div id="wizard-content"></div>
    </div>
  </div>

  <!-- JS will be added in the next step -->
<script>
  // ========================
// 90-Day 5-Goal Tracker
// ========================

// --------- CONFIGURATION AND STORAGE ----------
const DEFAULTS = {
  challengeTitle: "90-Day 5-Goal Daily Tracker",
  startDate: new Date().toISOString().slice(0,10),
  goals: [
    "Complete walk/jog",
    "Take medication",
    "Weight lifting & pushups",
    "Laundry/trash/floor care",
    "1hr video editing/voice acting/programming"
  ],
  goalDescs: [
    "Complete your daily walk or jog. The goal is to build endurance and get closer to your 1hr 15min walking/jogging target.",
    "Take any daily medications or supplements as prescribed. Prioritize your health routines.",
    "Do your weight lifting and pushup routine for the day. Build strength and stay active.",
    "Take care of laundry, trash, and floors. A clean environment supports a clear mind.",
    "Work for 1 hour on video editing, voice acting, or programming. Progress adds up!"
  ]
};
const STORAGE_KEY = "my_90day_goal_tracker_custom_v2";

function getSavedData() {
  try { return JSON.parse(localStorage.getItem(STORAGE_KEY)) || {}; } catch { return {}; }
}
function saveData(data) {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
}
function getChallengeConfig() {
  const data = getSavedData();
  if (!data.challenge) {
    return {...DEFAULTS, days: 90};
  }
  return {...data.challenge, days: 90}; // always 90
}
function saveChallengeConfig(config) {
  let data = getSavedData();
  data.challenge = config;
  saveData(data);
}

// --------- RENDER TABLE AND GOALS ----------
function genDates(startDate, days) {
  let arr = [];
  let d = new Date(startDate + "T00:00:00");
  for(let i=0; i<days; i++) {
    let nd = new Date(d);
    nd.setDate(d.getDate() + i);
    arr.push(nd);
  }
  return arr;
}

function renderTable() {
  const config = getChallengeConfig();
  const {goals, goalDescs, startDate, days} = config;
  let data = getSavedData();
  data.progress = data.progress || {};
  data.notes = data.notes || {};
  data.perfectPlayed = data.perfectPlayed || {};
  let tbody = document.getElementById('tracker-body');
  tbody.innerHTML = '';
  let allDates = genDates(startDate, days);
  let total = 0, completed = 0;
  let todayStr = (new Date()).toLocaleDateString('en-US', {month:'2-digit',day:'2-digit',year:'numeric'});

  allDates.forEach((dateObj, row) => {
    let dateStr = dateObj.toLocaleDateString('en-US', {month:'2-digit',day:'2-digit',year:'numeric'});
    let dayName = dateObj.toLocaleDateString('en-US', {weekday:'short'});
    // --- Main goals row ---
    let tr = document.createElement('tr');
    if (dateStr === todayStr) tr.classList.add('today-row');
    // Date + day name
    let tdDate = document.createElement('td');
    tdDate.innerHTML = `<b>${dayName}</b> ${dateStr}`;
    tr.appendChild(tdDate);
    let perfect = true;
    let doneArr = [];
    for(let col=0; col<goals.length; col++) {
      total++;
      let cellId = `${row}_${col}`;
      let done = data.progress[cellId] === true;
      doneArr.push(done);
      let td = document.createElement('td');
      let group = document.createElement('div');
      group.className = "goal-btn-group";
      let btn = document.createElement('button');
      btn.className = 'goal-btn' + (done ? ' completed' : '');
      btn.textContent = done ? 'Done' : 'Mark Done';
      btn.onclick = () => {
        let nowDone = !done;
        data.progress[cellId] = nowDone;
        saveData(data);
        if (nowDone) playSound();

        // --- PERFECT SOUND LOGIC ---
        // Only play when marking the LAST goal complete
        let goalsThisDay = [];
        for (let cc = 0; cc < goals.length; cc++) {
          if (cc === col) {
            goalsThisDay.push(nowDone);
          } else {
            goalsThisDay.push(data.progress[`${row}_${cc}`] === true);
          }
        }
        let allDone = goalsThisDay.every(Boolean);
        if (allDone && !data.perfectPlayed[row]) {
          playPerfectSound();
          data.perfectPlayed[row] = true;
          saveData(data);
        }
        if (!allDone && data.perfectPlayed[row]) {
          data.perfectPlayed[row] = false;
          saveData(data);
        }
        renderTable();
      };
      group.appendChild(btn);
      let starSlot = document.createElement('span');
      starSlot.className = 'star-slot';
      if (done) { starSlot.appendChild(makeStar()); completed++; }
      group.appendChild(starSlot);
      td.appendChild(group);
      if (!done) perfect = false;
      tr.appendChild(td);
    }
    // Perfect day
    let tdPerfect = document.createElement('td');
    if (perfect) {
      tdPerfect.innerHTML = `<span class="perfect-day">üåü</span> <span style="color:#389e6c;font-size:1.03em;font-weight:700;">Perfect!</span>`;
    }
    tr.appendChild(tdPerfect);
    tbody.appendChild(tr);

    // --- Notes row (always after the day's row) ---
    let trNote = document.createElement('tr');
    trNote.className = "notes-row";
    let tdNote = document.createElement('td');
    tdNote.colSpan = 7;
    tdNote.innerHTML = `
      <span class="note-label">Note for <b>${dayName} ${dateStr}</b>:</span>
      <textarea class="note-input" rows="2" placeholder="Add note..."></textarea>
    `;
    let noteInput = tdNote.querySelector('textarea');
    noteInput.value = data.notes[row] || "";
    noteInput.onchange = function() {
      data.notes[row] = noteInput.value;
      saveData(data);
    };
    trNote.appendChild(tdNote);
    tbody.appendChild(trNote);
  });

  // Update progress
  let percent = Math.round((completed/total)*1000)/10;
  document.getElementById('percent').textContent = `${completed} / ${total} (${percent}%) completed`;
  document.getElementById('progress-bar').style.width = `${percent}%`;

  // Show goal names and dates
  document.querySelectorAll('.goal-name').forEach((th, i) => {
    th.textContent = goals[i];
    th.setAttribute('title', goalDescs[i]);
  });

  // Challenge info at top
  document.getElementById('challenge-title').textContent = config.challengeTitle || DEFAULTS.challengeTitle;
  let endDate = allDates[allDates.length-1];
  let prettyStart = allDates[0].toLocaleDateString('en-US', {month:'short', day:'2-digit', year:'numeric'});
  let prettyEnd = endDate.toLocaleDateString('en-US', {month:'short', day:'2-digit', year:'numeric'});
  document.getElementById('challenge-dates').textContent = `From ${prettyStart} to ${prettyEnd} (${days} days) ‚Ä¢ Goal: 80%+ completion`;
}

function makeStar() {
  let span = document.createElement('span');
  span.className = 'star';
  span.textContent = '‚≠ê';
  return span;
}

function playSound() {
  let audio = document.getElementById('success-sound');
  if (audio) {
    audio.currentTime = 0;
    audio.play();
  }
}

function playPerfectSound() {
  let audio = document.getElementById('perfect-sound');
  if (audio) {
    audio.currentTime = 0;
    audio.play();
  }
}

// ---------- GOAL MODAL ----------
function openGoalModal(goalId) {
  const config = getChallengeConfig();
  document.getElementById('goal-modal-title').textContent = config.goals[goalId];
  document.getElementById('goal-modal-desc').textContent = config.goalDescs[goalId];
  document.getElementById('goal-modal-bg').classList.add('active');
}
function closeGoalModal() {
  document.getElementById('goal-modal-bg').classList.remove('active');
}

// ---------- STEP-BY-STEP WIZARD ----------
function openWizard() {
  wizardStep = 0;
  wizardData = {
    challengeTitle: "",
    startDate: new Date().toISOString().slice(0,10),
    goals: [],
    goalDescs: []
  };
  renderWizardStep();
  document.getElementById('wizard-modal-bg').classList.add('active');
}
function closeWizard() {
  document.getElementById('wizard-modal-bg').classList.remove('active');
}
let wizardStep = 0;
let wizardData = {};
const wizardTotalSteps = 12; // 0: name, 1: date, 2: g1, 3: d1, ..., 10:g5, 11:d5, 12:review

function renderWizardStep() {
  const c = wizardData;
  const content = document.getElementById('wizard-content');
  let step = wizardStep;
  content.innerHTML = '';
  function makeInput(label, id, val, type="text", placeholder="", required=true) {
    return `<label style="text-align:left;display:block;font-weight:600;margin-bottom:4px;margin-top:4px;">${label}</label>
    <input class="wizard-input" type="${type}" id="${id}" value="${val||''}" placeholder="${placeholder||''}" ${required?'required':''} autofocus>`;
  }
  function makeTextarea(label, id, val, placeholder="", required=true) {
    return `<label style="text-align:left;display:block;font-weight:600;margin-bottom:4px;margin-top:4px;">${label}</label>
    <textarea class="wizard-textarea" id="${id}" placeholder="${placeholder||''}" ${required?'required':''} autofocus>${val||''}</textarea>`;
  }
  // Wizard progress
  let progressText = '';
  if(step<=11) progressText = `<div class="wizard-progress">Step ${step+1} of 12</div>`;
  // Steps
  if (step === 0) {
    content.innerHTML = `
      ${progressText}
      <div class="wizard-step">
        <h2>What is the name of your challenge?</h2>
        ${makeInput("Challenge Name", "wizTitle", c.challengeTitle||"", "text", "Ex: 90-Day Transformation")}
      </div>
      <div class="wizard-actions">
        <button id="wizNext">Next</button>
      </div>
    `;
    document.getElementById('wizNext').onclick = () => {
      c.challengeTitle = document.getElementById('wizTitle').value.trim() || DEFAULTS.challengeTitle;
      wizardStep++; renderWizardStep();
    };
  } else if (step === 1) {
    content.innerHTML = `
      ${progressText}
      <div class="wizard-step">
        <h2>Pick a start date</h2>
        ${makeInput("Start Date", "wizDate", c.startDate||new Date().toISOString().slice(0,10), "date", "", true)}
      </div>
      <div class="wizard-actions">
        <button id="wizPrev">Back</button>
        <button id="wizNext">Next</button>
      </div>
    `;
    document.getElementById('wizPrev').onclick = () => { wizardStep--; renderWizardStep(); }
    document.getElementById('wizNext').onclick = () => {
      c.startDate = document.getElementById('wizDate').value || new Date().toISOString().slice(0,10);
      wizardStep++; renderWizardStep();
    };
  } else if (step >=2 && step<=11) {
    // Steps 2,3 (goal1 name, desc), 4,5 (goal2 name, desc), ...
    let goalIdx = Math.floor((step-2)/2);
    let isDesc = ((step-2)%2===1);
    if (!isDesc) {
      // Name step
      content.innerHTML = `
        ${progressText}
        <div class="wizard-step">
          <h2>Goal ${goalIdx+1} Name</h2>
          ${makeInput(`Goal ${goalIdx+1} Name`, `wizGoal${goalIdx}`, c.goals[goalIdx]||"", "text", "E.g. Daily exercise")}
        </div>
        <div class="wizard-actions">
          <button id="wizPrev">Back</button>
          <button id="wizNext">Next</button>
        </div>
      `;
      document.getElementById('wizPrev').onclick = () => { wizardStep--; renderWizardStep(); }
      document.getElementById('wizNext').onclick = () => {
        c.goals[goalIdx] = document.getElementById(`wizGoal${goalIdx}`).value.trim() || DEFAULTS.goals[goalIdx];
        wizardStep++; renderWizardStep();
      };
    } else {
      // Desc step
      content.innerHTML = `
        ${progressText}
        <div class="wizard-step">
          <h2>Goal ${goalIdx+1} Description</h2>
          ${makeTextarea(`Goal ${goalIdx+1} Description`, `wizDesc${goalIdx}`, c.goalDescs[goalIdx]||"", "Describe the goal.")}
        </div>
        <div class="wizard-actions">
          <button id="wizPrev">Back</button>
          <button id="wizNext">Next</button>
        </div>
      `;
      document.getElementById('wizPrev').onclick = () => { wizardStep--; renderWizardStep(); }
      document.getElementById('wizNext').onclick = () => {
        c.goalDescs[goalIdx] = document.getElementById(`wizDesc${goalIdx}`).value.trim() || DEFAULTS.goalDescs[goalIdx];
        wizardStep++; renderWizardStep();
      };
    }
  } else if (step === 12) {
    // Review step
    let goalsReview = '';
    for(let i=0;i<5;i++) {
      goalsReview += `<div class="wizard-summary">
        <b>Goal ${i+1}:</b> ${c.goals[i]||DEFAULTS.goals[i]}<br>
        <b>Description:</b> ${c.goalDescs[i]||DEFAULTS.goalDescs[i]}
      </div>`;
    }
    content.innerHTML = `
      <div class="wizard-progress">Step 13 of 13</div>
      <div class="wizard-step">
        <h2>Review & Start</h2>
        <div class="wizard-summary"><b>Challenge Name:</b> ${c.challengeTitle||DEFAULTS.challengeTitle}</div>
        <div class="wizard-summary"><b>Start Date:</b> ${c.startDate||new Date().toISOString().slice(0,10)}</div>
        ${goalsReview}
      </div>
      <div class="wizard-actions">
        <button id="wizPrev">Back</button>
        <button id="wizStart">Start Challenge</button>
      </div>
    `;
    document.getElementById('wizPrev').onclick = () => { wizardStep--; renderWizardStep(); }
    document.getElementById('wizStart').onclick = () => {
      // Save challenge, clear progress/notes, close wizard
      let config = {
        challengeTitle: c.challengeTitle || DEFAULTS.challengeTitle,
        startDate: c.startDate || DEFAULTS.startDate,
        days: 90,
        goals: c.goals.map((g,i)=>g||DEFAULTS.goals[i]),
        goalDescs: c.goalDescs.map((d,i)=>d||DEFAULTS.goalDescs[i])
      };
      let data = getSavedData();
      data.challenge = config;
      data.progress = {};
      data.notes = {};
      data.perfectPlayed = {};
      saveData(data);
      closeWizard();
      renderTable();
    };
  }
}

// ---- DOM EVENT HOOKS ----
document.addEventListener('DOMContentLoaded', function() {
  renderTable();
  // Goal name modal open
  document.querySelectorAll('.goal-name').forEach(th => {
    th.addEventListener('click', function(e) {
      let gid = Number(this.getAttribute('data-goalid'));
      openGoalModal(gid);
    });
  });
  document.getElementById('close-goal-modal').onclick = closeGoalModal;
  document.getElementById('goal-modal-bg').onclick = function(e) {
    if (e.target === this) closeGoalModal();
  };
  // Wizard open/close
  document.getElementById('open-wizard-btn').onclick = openWizard;
  document.getElementById('close-wizard-modal').onclick = closeWizard;
  document.getElementById('wizard-modal-bg').onclick = function(e) {
    if (e.target === this) closeWizard();
  };
  // ESC closes modals
  window.addEventListener('keydown', function(e) {
    if (e.key === "Escape") {
      closeGoalModal();
      closeWizard();
    }
  });
  // If there is no challenge, launch wizard
  const data = getSavedData();
  if (!data.challenge) openWizard();
});
</script>
</body>
</html>
